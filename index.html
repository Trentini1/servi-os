<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório Técnico SAAM Towage</title>
    
    <!-- Motor Tailwind CSS (Carrega o estilo visual) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM (Motor da Aplicação) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (Traduz o código JSX para o navegador entender) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Ajustes finos para impressão que o Tailwind às vezes perde no CDN */
        @media print {
            @page { margin: 0; size: A4; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
        
        /* Animações simples */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans antialiased selection:bg-blue-500 selection:text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ÍCONES SVG (Para não depender de bibliotecas externas) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Anchor: (props) => <Icon {...props} path={<><circle cx="12" cy="5" r="3"/><line x1="12" x2="12" y1="22" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></>} />,
            ArrowLeft: (props) => <Icon {...props} path={<><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></>} />,
            Calendar: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
            Camera: (props) => <Icon {...props} path={<><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            FileText: (props) => <Icon {...props} path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Printer: (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Ship: (props) => <Icon {...props} path={<><path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.9 5.8 2.8 8"/><path d="M10 10V4a2 2 0 0 1 2-2a2 2 0 0 1 2 2v6"/><path d="M12 15v5"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
        };

        const SAAM_BRANCHES = [
            "SAAM Towage Brasil S.A. - Matriz (Rio de Janeiro)",
            "SAAM Towage Brasil S.A. - Filial Santos",
            "SAAM Towage Brasil S.A. - Filial Rio Grande",
            "SAAM Towage Brasil S.A. - Filial Sepetiba",
            "SAAM Towage Brasil S.A. - Filial Suape",
            "SAAM Towage Brasil S.A. - Filial São Luís",
            "SAAM Towage Brasil S.A. - Filial Salvador",
            "SAAM Towage Brasil S.A. - Filial Vitória",
            "SAAM Towage Brasil S.A. - Filial Navegantes",
            "SAAM Towage Brasil S.A. - Filial São Francisco do Sul",
            "SAAM Towage Brasil S.A. - Filial Paranaguá"
        ];

        const ENGINE_POSITIONS = [
            { id: 'bb', label: 'Bombordo (BB)', short: 'BB' },
            { id: 'be', label: 'Boreste (BE)', short: 'BE' },
            { id: 'vante', label: 'Vante', short: 'Vante' },
            { id: 're', label: 'Ré', short: 'Ré' }
        ];

        const ENGINE_MODELS = [
            "Caterpillar C4.4",
            "Caterpillar 3304",
            "Caterpillar 3056",
            "Caterpillar 3406",
            "Caterpillar C18",
            "Caterpillar C32",
            "Deutz Weichai",
            "Deutz MWM",
            "Cummins KTA19",
            "Cummins NTA855",
            "Scania DI13",
            "MTU 4000 Series",
            "Yanmar 6EY"
        ];

        function App() {
            const [view, setView] = useState('form');
            const [formData, setFormData] = useState({
                branch: SAAM_BRANCHES[0],
                vesselName: '',
                enginePosition: '',
                engineModel: '',
                technicianName: '',
                date: new Date().toISOString().split('T')[0],
                serviceType: 'Preventiva',
                description: '',
                runningHours: '',
                photos: []
            });

            useEffect(() => {
                if (view === 'preview') {
                    const timer = setTimeout(() => {
                        try { window.print(); } catch (e) { console.log("Auto-print blocked"); }
                    }, 800);
                    return () => clearTimeout(timer);
                }
            }, [view]);

            const handlePhotoUpload = (e) => {
                if (e.target.files) {
                    const newPhotos = Array.from(e.target.files).map(file => ({
                        id: Date.now() + Math.random(),
                        url: URL.createObjectURL(file),
                        caption: ''
                    }));
                    setFormData(prev => ({ ...prev, photos: [...prev.photos, ...newPhotos] }));
                }
            };

            const removePhoto = (id) => {
                setFormData(prev => ({ ...prev, photos: prev.photos.filter(p => p.id !== id) }));
            };

            const updateCaption = (id, text) => {
                setFormData(prev => ({
                    ...prev,
                    photos: prev.photos.map(p => p.id === id ? { ...p, caption: text } : p)
                }));
            };

            const isFormValid = () => {
                return formData.vesselName && formData.enginePosition && formData.engineModel && formData.technicianName && formData.description;
            };

            return (
                <div className="min-h-screen">
                    {/* --- INTERFACE DE EDIÇÃO (Oculta na impressão) --- */}
                    <div className="no-print max-w-lg mx-auto pb-24">
                        
                        <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-md border-b border-slate-700 p-4 shadow-lg">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <div className="bg-blue-600 p-2 rounded-lg">
                                        <Icons.Anchor size={20} className="text-white" />
                                    </div>
                                    <h1 className="font-bold text-lg tracking-tight">TechReport <span className="text-blue-400">Pro</span></h1>
                                </div>
                                {view === 'preview' && (
                                    <button onClick={() => setView('form')} className="text-sm font-medium text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                                        <Icons.ArrowLeft size={14} /> Editar
                                    </button>
                                )}
                            </div>
                        </header>

                        {view === 'form' ? (
                            <main className="p-4 space-y-6 fade-in">
                                
                                <section className="space-y-4">
                                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.FileText size={14} /> Dados Corporativos
                                    </h2>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Filial SAAM Towage</label>
                                        <select className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                            value={formData.branch} onChange={(e) => setFormData({...formData, branch: e.target.value})}>
                                            {SAAM_BRANCHES.map(b => <option key={b} value={b}>{b}</option>)}
                                        </select>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="text-sm font-medium text-slate-300">Data</label>
                                            <div className="relative">
                                                <div className="absolute left-3 top-3 text-slate-500"><Icons.Calendar size={16} /></div>
                                                <input type="date" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                                    value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} />
                                            </div>
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-sm font-medium text-slate-300">Horímetro</label>
                                            <input type="number" placeholder="Ex: 12500" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                                value={formData.runningHours} onChange={(e) => setFormData({...formData, runningHours: e.target.value})} />
                                        </div>
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.Ship size={14} /> Embarcação & Equipamento
                                    </h2>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Embarcação</label>
                                        <input type="text" placeholder="SAAM PUMA" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none uppercase"
                                            value={formData.vesselName} onChange={(e) => setFormData({...formData, vesselName: e.target.value})} />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Posição</label>
                                        <div className="grid grid-cols-4 gap-2">
                                            {ENGINE_POSITIONS.map((pos) => (
                                                <button key={pos.id} onClick={() => setFormData({...formData, enginePosition: pos.label})}
                                                    className={`p-2 rounded-lg text-xs font-bold transition-all border ${formData.enginePosition === pos.label ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-400'}`}>
                                                    {pos.short}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Modelo MCA</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-500"><Icons.Settings size={16} /></div>
                                            <input list="engine-models" type="text" placeholder="Selecione..." className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                                value={formData.engineModel} onChange={(e) => setFormData({...formData, engineModel: e.target.value})} />
                                            <datalist id="engine-models">{ENGINE_MODELS.map(m => <option key={m} value={m} />)}</datalist>
                                        </div>
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.CheckCircle size={14} /> Detalhes
                                    </h2>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Técnico</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-500"><Icons.User size={16} /></div>
                                            <input type="text" placeholder="Seu nome" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                                value={formData.technicianName} onChange={(e) => setFormData({...formData, technicianName: e.target.value})} />
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Descrição</label>
                                        <textarea rows={8} placeholder="Relate o serviço..." className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                            value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} />
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.Camera size={14} /> Fotos
                                    </h2>
                                    <div className="grid grid-cols-2 gap-3">
                                        {formData.photos.map((photo) => (
                                            <div key={photo.id} className="relative group bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
                                                <img src={photo.url} className="w-full h-32 object-cover" />
                                                <button onClick={() => removePhoto(photo.id)} className="absolute top-1 right-1 bg-red-600 text-white p-1 rounded-full opacity-80 hover:opacity-100">
                                                    <Icons.Trash2 size={12} />
                                                </button>
                                                <input type="text" placeholder="Legenda..." className="w-full bg-slate-800 text-xs p-2 text-slate-300 border-t border-slate-700 outline-none"
                                                    value={photo.caption} onChange={(e) => updateCaption(photo.id, e.target.value)} />
                                            </div>
                                        ))}
                                        <label className="flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-700 rounded-lg cursor-pointer hover:bg-slate-800/50">
                                            <Icons.Plus size={20} className="text-blue-500 mb-2" />
                                            <span className="text-xs text-slate-400">Add Foto</span>
                                            <input type="file" accept="image/*" multiple className="hidden" onChange={handlePhotoUpload} />
                                        </label>
                                    </div>
                                </section>
                            </main>
                        ) : (
                            <div className="p-6 flex flex-col items-center justify-center min-h-[60vh] text-center fade-in">
                                <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-green-500/30">
                                    <Icons.CheckCircle size={40} className="text-white" />
                                </div>
                                <h2 className="text-2xl font-bold text-white mb-2">Pronto!</h2>
                                <p className="text-slate-400 text-sm mb-8">O PDF deve abrir automaticamente.</p>
                                <button onClick={() => window.print()} className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-xl flex items-center gap-2">
                                    <Icons.Download size={20} /> BAIXAR PDF MANUALMENTE
                                </button>
                                <p className="mt-4 text-xs text-slate-500">Selecione papel <strong>A4</strong> na impressão.</p>
                            </div>
                        )}

                        {view === 'form' && (
                            <div className="fixed bottom-0 left-0 right-0 p-4 bg-slate-900/90 backdrop-blur border-t border-slate-800 z-30">
                                <button disabled={!isFormValid()} onClick={() => setView('preview')}
                                    className={`w-full font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 shadow-xl ${isFormValid() ? 'bg-blue-600 text-white hover:bg-blue-500' : 'bg-slate-800 text-slate-500'}`}>
                                    <Icons.Printer size={20} /> Gerar Relatório
                                </button>
                            </div>
                        )}
                    </div>

                    {/* --- ÁREA DE IMPRESSÃO (PDF) --- */}
                    <div className="print-only bg-white text-black w-full max-w-[210mm] mx-auto p-[15mm] h-screen">
                        <div className="flex justify-between items-start border-b-2 border-slate-800 pb-4 mb-6">
                            <div>
                                <h1 className="text-2xl font-black text-slate-800 uppercase mb-1">Relatório Técnico</h1>
                                <p className="text-xs font-semibold text-slate-500 uppercase tracking-widest">Manutenção & Engenharia</p>
                            </div>
                            <div className="text-right">
                                <div className="text-xl font-bold text-slate-900">SAAM TOWAGE</div>
                                <div className="text-[10px] text-slate-500 mt-1 max-w-[200px] leading-tight">{formData.branch}</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-x-6 gap-y-4 mb-6 bg-slate-50 p-4 rounded border border-slate-200 text-sm">
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Embarcação</span><span className="font-bold text-slate-900">{formData.vesselName}</span></div>
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Data</span><span className="font-bold text-slate-900">{new Date(formData.date).toLocaleDateString('pt-BR')}</span></div>
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Equipamento</span><span className="font-semibold text-slate-800">{formData.engineModel}</span></div>
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Posição</span><span className="font-semibold text-slate-800">{formData.enginePosition}</span></div>
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Horímetro</span><span className="font-semibold text-slate-800">{formData.runningHours} Hrs</span></div>
                            <div><span className="block text-[10px] font-bold text-slate-400 uppercase">Tipo Serviço</span><span className="font-semibold text-slate-800">{formData.serviceType}</span></div>
                        </div>

                        <div className="mb-6">
                            <h3 className="text-xs font-bold text-slate-900 uppercase border-b border-slate-300 pb-1 mb-2">Descrição do Atendimento</h3>
                            <div className="text-xs leading-relaxed text-justify text-slate-800 whitespace-pre-wrap font-medium">{formData.description}</div>
                        </div>

                        {formData.photos.length > 0 && (
                            <div className="mb-6">
                                <h3 className="text-xs font-bold text-slate-900 uppercase border-b border-slate-300 pb-1 mb-4">Registro Fotográfico</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    {formData.photos.map((photo) => (
                                        <div key={photo.id} className="mb-2 break-inside-avoid">
                                            <div className="border border-slate-200 rounded overflow-hidden h-48 bg-slate-100 flex items-center justify-center">
                                                <img src={photo.url} className="max-w-full max-h-full object-contain" />
                                            </div>
                                            {photo.caption && <p className="mt-1 text-[10px] text-slate-600 italic border-l-2 border-slate-300 pl-2">{photo.caption}</p>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="mt-8 pt-8 border-t border-slate-200 break-inside-avoid">
                            <div className="grid grid-cols-2 gap-12">
                                <div className="text-center">
                                    <div className="border-b border-slate-800 mb-1 h-8"></div>
                                    <p className="font-bold text-slate-900 text-xs">{formData.technicianName}</p>
                                    <p className="text-[10px] text-slate-500 uppercase">Técnico Responsável</p>
                                </div>
                                <div className="text-center">
                                    <div className="border-b border-slate-300 mb-1 h-8"></div>
                                    <p className="font-bold text-slate-900 text-xs">Responsável da Embarcação</p>
                                    <p className="text-[10px] text-slate-500 uppercase">Chefe de Máquinas</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
