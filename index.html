<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório Técnico - Retiblocos</title>
    
    <!-- Motor Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Ajustes de Impressão A4 */
        @media print {
            @page { margin: 0; size: A4; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white; }
            .no-print { display: none !important; }
            .print-only { display: block !important; height: 100vh; }
            .page-break { break-inside: avoid; }
        }
        .print-only { display: none; }
        
        /* Utilitários de Animação e Canvas */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        canvas { touch-action: none; } /* Impede scroll enquanto assina */
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans antialiased selection:bg-orange-500 selection:text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ÍCONES SVG ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Anchor: (props) => <Icon {...props} path={<><circle cx="12" cy="5" r="3"/><line x1="12" x2="12" y1="22" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></>} />,
            ArrowLeft: (props) => <Icon {...props} path={<><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></>} />,
            Calendar: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
            Clock: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            Camera: (props) => <Icon {...props} path={<><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            FileText: (props) => <Icon {...props} path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Printer: (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Ship: (props) => <Icon {...props} path={<><path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.9 5.8 2.8 8"/><path d="M10 10V4a2 2 0 0 1 2-2a2 2 0 0 1 2 2v6"/><path d="M12 15v5"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Pen: (props) => <Icon {...props} path={<><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></>} />,
            Refresh: (props) => <Icon {...props} path={<><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>} />
        };

        const SAAM_BRANCHES = [
            "SAAM Towage Brasil S.A. - Matriz (Rio de Janeiro)",
            "SAAM Towage Brasil S.A. - Filial Santos",
            "SAAM Towage Brasil S.A. - Filial Rio Grande",
            "SAAM Towage Brasil S.A. - Filial Sepetiba",
            "SAAM Towage Brasil S.A. - Filial Suape",
            "SAAM Towage Brasil S.A. - Filial São Luís",
            "SAAM Towage Brasil S.A. - Filial Salvador",
            "SAAM Towage Brasil S.A. - Filial Vitória",
            "SAAM Towage Brasil S.A. - Filial Navegantes",
            "SAAM Towage Brasil S.A. - Filial São Francisco do Sul",
            "SAAM Towage Brasil S.A. - Filial Paranaguá"
        ];

        const ENGINE_POSITIONS = [
            { id: 'bb', label: 'Bombordo (BB)', short: 'BB' },
            { id: 'be', label: 'Boreste (BE)', short: 'BE' },
            { id: 'vante', label: 'Vante', short: 'Vante' },
            { id: 're', label: 'Ré', short: 'Ré' }
        ];

        const ENGINE_MODELS = [
            "Caterpillar C4.4",
            "Caterpillar 3304",
            "Caterpillar 3056",
            "Caterpillar 3406",
            "Caterpillar C18",
            "Caterpillar C32",
            "Deutz Weichai",
            "Deutz MWM",
            "Cummins KTA19",
            "Cummins NTA855",
            "Scania DI13",
            "MTU 4000 Series",
            "Yanmar 6EY"
        ];

        // --- COMPONENTE DE ASSINATURA ---
        const SignaturePad = ({ onSave, onCancel }) => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);

            useEffect(() => {
                const canvas = canvasRef.current;
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                const ctx = canvas.getContext('2d');
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
            }, []);

            const getPos = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            };

            const startDrawing = (e) => {
                const ctx = canvasRef.current.getContext('2d');
                const { x, y } = getPos(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
                setIsDrawing(true);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const ctx = canvasRef.current.getContext('2d');
                const { x, y } = getPos(e);
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                const ctx = canvasRef.current.getContext('2d');
                ctx.closePath();
                setIsDrawing(false);
            };

            const clear = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };

            const save = () => {
                const dataUrl = canvasRef.current.toDataURL('image/png');
                onSave(dataUrl);
            };

            return (
                <div className="fixed inset-0 z-50 bg-slate-900/95 flex flex-col items-center justify-center p-4">
                    <div className="bg-white w-full max-w-md rounded-xl overflow-hidden shadow-2xl">
                        <div className="bg-slate-100 p-4 border-b flex justify-between items-center">
                            <h3 className="text-slate-800 font-bold">Assine Abaixo</h3>
                            <button onClick={clear} className="text-slate-500 hover:text-red-500">
                                <Icons.Refresh size={20} />
                            </button>
                        </div>
                        <div className="h-64 bg-white cursor-crosshair">
                            <canvas 
                                ref={canvasRef}
                                className="w-full h-full touch-none"
                                onMouseDown={startDrawing}
                                onMouseMove={draw}
                                onMouseUp={stopDrawing}
                                onMouseLeave={stopDrawing}
                                onTouchStart={startDrawing}
                                onTouchMove={draw}
                                onTouchEnd={stopDrawing}
                            />
                        </div>
                        <div className="bg-slate-50 p-4 border-t flex gap-3">
                            <button onClick={onCancel} className="flex-1 py-3 font-semibold text-slate-500 hover:bg-slate-200 rounded-lg">Cancelar</button>
                            <button onClick={save} className="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">Confirmar</button>
                        </div>
                    </div>
                    <p className="mt-4 text-slate-400 text-sm">Use o dedo ou mouse para assinar.</p>
                </div>
            );
        };

        function App() {
            const [view, setView] = useState('form'); // 'form', 'signing', 'preview'
            const [formData, setFormData] = useState({
                branch: SAAM_BRANCHES[0],
                vesselName: '',
                enginePosition: '',
                engineModel: '',
                technicianName: '',
                startDate: new Date().toISOString().split('T')[0],
                startTime: '08:00',
                endDate: new Date().toISOString().split('T')[0],
                endTime: '17:00',
                serviceType: 'Preventiva',
                description: '',
                runningHours: '',
                photos: [],
                signature: null
            });

            // Auto-print effect
            useEffect(() => {
                if (view === 'preview') {
                    const timer = setTimeout(() => {
                        try { window.print(); } catch (e) { console.log("Auto-print blocked"); }
                    }, 800);
                    return () => clearTimeout(timer);
                }
            }, [view]);

            const handlePhotoUpload = (e) => {
                if (e.target.files) {
                    const newPhotos = Array.from(e.target.files).map(file => ({
                        id: Date.now() + Math.random(),
                        url: URL.createObjectURL(file),
                        caption: ''
                    }));
                    setFormData(prev => ({ ...prev, photos: [...prev.photos, ...newPhotos] }));
                }
            };

            const removePhoto = (id) => {
                setFormData(prev => ({ ...prev, photos: prev.photos.filter(p => p.id !== id) }));
            };

            const updateCaption = (id, text) => {
                setFormData(prev => ({
                    ...prev,
                    photos: prev.photos.map(p => p.id === id ? { ...p, caption: text } : p)
                }));
            };

            const handleSignatureSave = (dataUrl) => {
                setFormData(prev => ({ ...prev, signature: dataUrl }));
                setView('preview');
            };

            const isFormValid = () => {
                return formData.vesselName && formData.enginePosition && formData.engineModel && formData.technicianName && formData.description;
            };

            // Função para calcular duração do serviço
            const calculateDuration = () => {
                const start = new Date(`${formData.startDate}T${formData.startTime}`);
                const end = new Date(`${formData.endDate}T${formData.endTime}`);
                const diffMs = end - start;
                
                if (diffMs < 0) return "Erro nas datas";
                
                const diffHrs = Math.floor(diffMs / 3600000);
                const diffMins = Math.round(((diffMs % 3600000) / 60000));
                
                if (diffMins === 0) return `${diffHrs}h`;
                return `${diffHrs}h ${diffMins}min`;
            };

            const formatDate = (dateStr) => {
                return new Date(dateStr).toLocaleDateString('pt-BR');
            }

            return (
                <div className="min-h-screen">
                    {/* --- INTERFACE DO FORMULÁRIO (Mobile) --- */}
                    <div className="no-print max-w-lg mx-auto pb-24">
                        
                        <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-md border-b border-slate-700 p-4 shadow-lg">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <div className="bg-orange-600 p-2 rounded-lg text-white font-black tracking-tighter">RB</div>
                                    <div>
                                        <h1 className="font-bold text-lg tracking-tight leading-none text-white">Retiblocos</h1>
                                        <span className="text-xs text-slate-400 font-medium">Relatórios Técnicos</span>
                                    </div>
                                </div>
                                {view === 'preview' && (
                                    <button onClick={() => setView('form')} className="text-sm font-medium text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                                        <Icons.ArrowLeft size={14} /> Voltar
                                    </button>
                                )}
                            </div>
                        </header>

                        {view === 'form' ? (
                            <main className="p-4 space-y-6 fade-in">
                                
                                <section className="space-y-4">
                                    <h2 className="text-xs font-bold text-orange-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.FileText size={14} /> Cliente
                                    </h2>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Filial SAAM Towage</label>
                                        <select className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none"
                                            value={formData.branch} onChange={(e) => setFormData({...formData, branch: e.target.value})}>
                                            {SAAM_BRANCHES.map(b => <option key={b} value={b}>{b}</option>)}
                                        </select>
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-orange-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.Ship size={14} /> Equipamento
                                    </h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="text-sm font-medium text-slate-300">Embarcação</label>
                                            <input type="text" placeholder="SAAM PUMA" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none uppercase"
                                                value={formData.vesselName} onChange={(e) => setFormData({...formData, vesselName: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-sm font-medium text-slate-300">Modelo MCA</label>
                                            <input list="engine-models" type="text" placeholder="Mod." className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none"
                                                value={formData.engineModel} onChange={(e) => setFormData({...formData, engineModel: e.target.value})} />
                                            <datalist id="engine-models">{ENGINE_MODELS.map(m => <option key={m} value={m} />)}</datalist>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Posição</label>
                                        <div className="grid grid-cols-4 gap-2">
                                            {ENGINE_POSITIONS.map((pos) => (
                                                <button key={pos.id} onClick={() => setFormData({...formData, enginePosition: pos.label})}
                                                    className={`p-2 rounded-lg text-xs font-bold transition-all border ${formData.enginePosition === pos.label ? 'bg-orange-600 border-orange-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-400'}`}>
                                                    {pos.short}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Horímetro</label>
                                        <input type="number" placeholder="12345" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none"
                                            value={formData.runningHours} onChange={(e) => setFormData({...formData, runningHours: e.target.value})} />
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-orange-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.Clock size={14} /> Período de Atendimento
                                    </h2>
                                    
                                    <div className="bg-slate-800/50 p-3 rounded-xl border border-slate-700 space-y-3">
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="space-y-1">
                                                <label className="text-xs text-slate-400 font-bold uppercase">Início do Serviço</label>
                                                <input type="date" className="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm text-slate-200 outline-none"
                                                    value={formData.startDate} onChange={(e) => setFormData({...formData, startDate: e.target.value})} />
                                                <input type="time" className="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm text-slate-200 outline-none"
                                                    value={formData.startTime} onChange={(e) => setFormData({...formData, startTime: e.target.value})} />
                                            </div>
                                            
                                            <div className="space-y-1">
                                                <label className="text-xs text-slate-400 font-bold uppercase">Fim do Serviço</label>
                                                <input type="date" className="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm text-slate-200 outline-none"
                                                    value={formData.endDate} onChange={(e) => setFormData({...formData, endDate: e.target.value})} />
                                                <input type="time" className="w-full bg-slate-800 border border-slate-600 rounded-lg p-2 text-sm text-slate-200 outline-none"
                                                    value={formData.endTime} onChange={(e) => setFormData({...formData, endTime: e.target.value})} />
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-orange-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.CheckCircle size={14} /> Detalhes
                                    </h2>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Técnico Responsável</label>
                                        <input type="text" placeholder="Seu nome completo" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none"
                                            value={formData.technicianName} onChange={(e) => setFormData({...formData, technicianName: e.target.value})} />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-300">Descrição Técnica</label>
                                        <textarea rows={8} placeholder="Descreva o serviço executado..." className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-orange-500 outline-none"
                                            value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} />
                                    </div>
                                </section>

                                <section className="space-y-4 pt-4 border-t border-slate-800">
                                    <h2 className="text-xs font-bold text-orange-500 uppercase tracking-wider flex items-center gap-2">
                                        <Icons.Camera size={14} /> Evidências
                                    </h2>
                                    <div className="grid grid-cols-2 gap-3">
                                        {formData.photos.map((photo) => (
                                            <div key={photo.id} className="relative group bg-slate-800 rounded-lg overflow-hidden border border-slate-700">
                                                <img src={photo.url} className="w-full h-32 object-cover" />
                                                <button onClick={() => removePhoto(photo.id)} className="absolute top-1 right-1 bg-red-600 text-white p-1 rounded-full opacity-80 hover:opacity-100">
                                                    <Icons.Trash2 size={12} />
                                                </button>
                                                <input type="text" placeholder="Legenda..." className="w-full bg-slate-800 text-xs p-2 text-slate-300 border-t border-slate-700 outline-none"
                                                    value={photo.caption} onChange={(e) => updateCaption(photo.id, e.target.value)} />
                                            </div>
                                        ))}
                                        <label className="flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-700 rounded-lg cursor-pointer hover:bg-slate-800/50">
                                            <Icons.Plus size={20} className="text-orange-500 mb-2" />
                                            <span className="text-xs text-slate-400">Add Foto</span>
                                            <input type="file" accept="image/*" multiple className="hidden" onChange={handlePhotoUpload} />
                                        </label>
                                    </div>
                                </section>
                            </main>
                        ) : view === 'preview' ? (
                            <div className="p-6 flex flex-col items-center justify-center min-h-[60vh] text-center fade-in">
                                <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-green-500/30">
                                    <Icons.CheckCircle size={40} className="text-white" />
                                </div>
                                <h2 className="text-2xl font-bold text-white mb-2">Relatório Gerado</h2>
                                <p className="text-slate-400 text-sm mb-8">PDF pronto para salvar.</p>
                                <button onClick={() => window.print()} className="bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 px-8 rounded-xl flex items-center gap-2 shadow-lg w-full justify-center">
                                    <Icons.Download size={20} /> BAIXAR PDF
                                </button>
                                <button onClick={() => setView('form')} className="mt-4 text-slate-500 text-sm underline">Corrigir algo</button>
                            </div>
                        ) : null}

                        {/* Modal de Assinatura */}
                        {view === 'signing' && (
                            <SignaturePad 
                                onSave={handleSignatureSave} 
                                onCancel={() => setView('form')} 
                            />
                        )}

                        {view === 'form' && (
                            <div className="fixed bottom-0 left-0 right-0 p-4 bg-slate-900/90 backdrop-blur border-t border-slate-800 z-30">
                                <button disabled={!isFormValid()} onClick={() => setView('signing')}
                                    className={`w-full font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 shadow-xl ${isFormValid() ? 'bg-orange-600 text-white hover:bg-orange-500' : 'bg-slate-800 text-slate-500'}`}>
                                    <Icons.Pen size={20} /> Assinar e Gerar
                                </button>
                            </div>
                        )}
                    </div>

                    {/* --- PDF / LAYOUT DE IMPRESSÃO --- */}
                    <div className="print-only bg-white text-black w-full h-full p-[15mm] relative box-border">
                        
                        {/* Header Oficial */}
                        <div className="flex justify-between items-center border-b-4 border-orange-600 pb-4 mb-6">
                            <div className="flex items-center gap-4">
                                <div className="bg-orange-600 text-white p-3 font-black text-3xl tracking-tighter">RB</div>
                                <div>
                                    <h1 className="text-2xl font-black text-slate-900 uppercase tracking-tight leading-none">Retiblocos</h1>
                                    <p className="text-xs font-bold text-orange-600 uppercase tracking-widest">Engenharia e Manutenção</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <p className="text-[10px] text-slate-400 uppercase font-bold mb-1">Cliente</p>
                                <div className="text-lg font-bold text-slate-800 leading-none">SAAM TOWAGE</div>
                                <div className="text-[9px] text-slate-500 mt-1 max-w-[250px] leading-tight">{formData.branch}</div>
                            </div>
                        </div>

                        {/* Título e Período */}
                        <div className="bg-slate-100 border-l-4 border-slate-800 p-3 mb-6 flex justify-between items-center">
                            <div>
                                <h2 className="text-lg font-bold text-slate-800 uppercase leading-none">Relatório de Serviço Técnico</h2>
                            </div>
                            <div className="text-right">
                                <div className="text-[10px] text-slate-500 uppercase font-bold">Período de Execução</div>
                                <div className="text-sm font-mono font-bold text-slate-800">
                                    {formatDate(formData.startDate)} <span className="text-slate-400 mx-1">às</span> {formData.startTime} <span className="text-orange-500 mx-1">|</span> {formatDate(formData.endDate)} <span className="text-slate-400 mx-1">às</span> {formData.endTime}
                                </div>
                                <div className="text-[9px] font-bold text-orange-600 mt-0.5">Duração Total: {calculateDuration()}</div>
                            </div>
                        </div>

                        {/* Dados da Embarcação (Grid Estilizado) */}
                        <div className="mb-6 border border-slate-200 rounded-lg overflow-hidden">
                            <div className="bg-slate-800 text-white text-xs font-bold uppercase p-2 px-4">Dados do Equipamento</div>
                            <div className="grid grid-cols-4 divide-x divide-slate-200">
                                <div className="p-3">
                                    <span className="block text-[9px] font-bold text-slate-400 uppercase mb-1">Embarcação</span>
                                    <span className="font-bold text-slate-900 text-sm">{formData.vesselName}</span>
                                </div>
                                <div className="p-3">
                                    <span className="block text-[9px] font-bold text-slate-400 uppercase mb-1">Modelo MCA</span>
                                    <span className="font-bold text-slate-900 text-sm">{formData.engineModel}</span>
                                </div>
                                <div className="p-3">
                                    <span className="block text-[9px] font-bold text-slate-400 uppercase mb-1">Posição</span>
                                    <span className="font-bold text-slate-900 text-sm">{formData.enginePosition}</span>
                                </div>
                                <div className="p-3">
                                    <span className="block text-[9px] font-bold text-slate-400 uppercase mb-1">Horímetro</span>
                                    <span className="font-bold text-slate-900 text-sm">{formData.runningHours} hrs</span>
                                </div>
                            </div>
                        </div>

                        {/* Descrição Técnica */}
                        <div className="mb-6 flex-grow">
                            <div className="border-b border-slate-300 pb-1 mb-3">
                                <h3 className="text-xs font-bold text-orange-600 uppercase">Descrição do Serviço Executado</h3>
                            </div>
                            <div className="text-xs leading-relaxed text-justify text-slate-800 whitespace-pre-wrap font-medium p-2 border-l-2 border-slate-100 min-h-[100px]">
                                {formData.description}
                            </div>
                        </div>

                        {/* Fotos */}
                        {formData.photos.length > 0 && (
                            <div className="mb-6 page-break">
                                <div className="border-b border-slate-300 pb-1 mb-3">
                                    <h3 className="text-xs font-bold text-orange-600 uppercase">Registro Fotográfico</h3>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    {formData.photos.map((photo) => (
                                        <div key={photo.id} className="mb-2 border border-slate-100 rounded p-1 bg-white shadow-sm break-inside-avoid">
                                            <div className="overflow-hidden h-40 bg-slate-50 flex items-center justify-center mb-1">
                                                <img src={photo.url} className="max-w-full max-h-full object-contain" />
                                            </div>
                                            {photo.caption && <p className="text-[10px] text-slate-600 font-medium px-1">{photo.caption}</p>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Assinaturas (Rodapé) */}
                        <div className="mt-auto pt-6 border-t-2 border-slate-800 break-inside-avoid">
                            <div className="grid grid-cols-2 gap-12">
                                <div className="text-center">
                                    {formData.signature ? (
                                        <div className="h-16 flex items-end justify-center mb-1">
                                            <img src={formData.signature} className="h-14 object-contain" alt="Assinatura" />
                                        </div>
                                    ) : (
                                        <div className="h-16 border-b border-slate-300 mb-1"></div>
                                    )}
                                    <div className="border-t border-slate-400 w-3/4 mx-auto pt-1">
                                        <p className="font-bold text-slate-900 text-xs">{formData.technicianName}</p>
                                        <p className="text-[9px] text-orange-600 uppercase font-bold">Técnico Retiblocos</p>
                                    </div>
                                </div>
                                <div className="text-center">
                                    <div className="h-16 border-b border-slate-300 mb-1 flex items-end justify-center">
                                        {/* Espaço para assinatura manual do cliente */}
                                    </div>
                                    <div className="border-t border-slate-400 w-3/4 mx-auto pt-1">
                                        <p className="font-bold text-slate-900 text-xs">Aprovação SAAM</p>
                                        <p className="text-[9px] text-slate-500 uppercase">Chefe de Máquinas / Comandante</p>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-6 flex justify-between items-end text-[8px] text-slate-400">
                                <span>RETIBLOCOS ENGENHARIA - Relatório Técnico Digital</span>
                                <span>Gerado em {new Date().toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
